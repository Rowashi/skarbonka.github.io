<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>$karbonka Strzeżona</title>

<style>
body{
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background:#f7f7f8;
  margin:18px;
  text-align:center;
  color:#111;
}
.app{max-width:560px;margin:auto;}
.sum-box{
  background:#fff;border:1px solid #ddd;border-radius:10px;
  padding:10px;margin-bottom:14px;font-weight:600;
}
.list{display:flex;flex-direction:column;gap:8px;}
.row{
  display:grid;grid-template-columns:70px 1fr auto;
  align-items:center;gap:8px;
  background:#fff;border:1px solid #ddd;
  border-radius:10px;padding:8px;
}
.value{font-weight:700;}
.stats{font-size:.85rem;color:#444;}
button{
  border:1px solid #ddd;background:#fff;
  border-radius:8px;padding:6px 10px;
  font-size:1rem;cursor:pointer;
}
button:active{transform:scale(.97);}
.controls{margin-top:12px;}
canvas{margin-top:20px;}
footer{margin-top:10px;font-size:.9rem;color:#444;}
</style>
</head>

<body>
<div class="app">

<h2>$karbonka Strzeżona</h2>

<div class="sum-box">
  Suma oszczędności:
  <span style="color:green"><b id="sum">0</b> zł</span> / 5000 zł
</div>

<div class="list" id="list"></div>

<div class="controls">
  <button onclick="resetAll()">RESET SKARBONKI</button>
</div>

<footer>
  Powodzenia w <b style="color:green">oszczędzaniu</b>
</footer>

<canvas id="pie" width="220" height="220"></canvas>
<canvas id="bars" width="520" height="260"></canvas>

</div>

<script>
const TARGET = 5000;
const STORAGE_KEY = "skarbonka_nominaly";

const denominations = [
  0.10,0.20,0.50,1,2,5,
  10,20,50,100,200,500
];

const list = document.getElementById("list");
const sumEl = document.getElementById("sum");
const pieCtx = document.getElementById("pie").getContext("2d");
const barCtx = document.getElementById("bars").getContext("2d");

let data = load();

function load(){
  try{return JSON.parse(localStorage.getItem(STORAGE_KEY))||{}}
  catch{return {}}
}
function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(data));}
function resetAll(){
  if(confirm("Na pewno wyczyścić całą skarbonkę?")){
    data={}; save(); update();
  }
}
function totalSum(){
  return Object.entries(data).reduce((s,[k,v])=>s+k*v,0);
}

function render(){
  list.innerHTML="";
  denominations.forEach(val=>{
    const count=data[val]||0;
    const row=document.createElement("div");
    row.className="row";
    row.innerHTML=`
      <div class="value">${val<1?(val*100+" gr"):val+" zł"}</div>
      <div class="stats">
        ilość: <b>${count}</b> |
        suma: <b>${(count*val).toFixed(2)} zł</b>
      </div>
      <button>+</button>`;
    row.querySelector("button").onclick=()=>{
      data[val]=(data[val]||0)+1;
      save(); update();
    };
    list.appendChild(row);
  });
}

function drawPie(sum){
  const p=Math.min(sum/TARGET,1);
  pieCtx.clearRect(0,0,220,220);

  pieCtx.beginPath();
  pieCtx.arc(110,110,95,0,Math.PI*2);
  pieCtx.fillStyle="#fff"; pieCtx.fill();

  pieCtx.beginPath();
  pieCtx.moveTo(110,110);
  pieCtx.arc(110,110,95,-Math.PI/2,p*2*Math.PI-Math.PI/2);
  pieCtx.fillStyle="#00aa00"; pieCtx.fill();

  pieCtx.fillStyle="#000";
  pieCtx.font="bold 22px Arial";
  pieCtx.textAlign="center";
  pieCtx.textBaseline="middle";
  pieCtx.fillText(Math.round(p*100)+"%",110,110);
}

function drawBars(){
  barCtx.clearRect(0,0,520,260);
  const values=denominations.map(v=>(data[v]||0)*v);
  const max=Math.max(...values,1);

  denominations.forEach((v,i)=>{
    const h=(values[i]/max)*180;
    const x=20+i*40;
    barCtx.fillStyle="#00aa00";
    barCtx.fillRect(x,220-h,24,h);

    barCtx.fillStyle="#000";
    barCtx.font="10px Arial";
    barCtx.save();
    barCtx.translate(x+12,240);
    barCtx.rotate(-Math.PI/4);
    barCtx.fillText(v<1?(v*100+"g"):v+"zł",-10,0);
    barCtx.restore();
  });
}

function update(){
  const sum=totalSum();
  sumEl.textContent=sum.toFixed(2);
  render();
  drawPie(sum);
  drawBars();
}

update();
</script>
</body>
</html>
