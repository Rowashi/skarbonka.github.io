<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>$karbonka</title>

<style>
body{margin:0;font-family:system-ui;background:#f7f7f8;text-align:center}
.container{max-width:520px;margin:auto;padding:12px}
.total{font-size:1.4rem;font-weight:700;margin:8px 0}
.list{background:#fff;border-radius:12px;padding:8px;box-shadow:0 0 0 1px #ddd}
.row{display:grid;grid-template-columns:20px 1fr 70px 80px;align-items:center;gap:6px;padding:6px 0;border-bottom:1px solid #eee}
.row:last-child{border-bottom:none}
.dot{width:14px;height:14px;border-radius:50%}
.controls button{width:28px;height:28px;border-radius:6px;border:1px solid #ccc;background:#fff;font-size:1.1rem}
canvas{display:block;margin:10px auto}
</style>
</head>

<body>
<div class="container">

<h2>$karbonka</h2>
<div class="total">Suma: <span id="sum" style="color:green">0</span> zł</div>

<canvas id="pie" width="220" height="220"></canvas>
<div class="list" id="list"></div>
<canvas id="bars" width="520" height="180"></canvas>

<button onclick="resetAll()">Reset</button>

</div>

<script>
const goal=5000;
const denominations=[0.1,0.2,0.5,1,2,5,10,20,50,100,200,500];

const colors={
0.1:"#cfd8dc",0.2:"#b0bec5",0.5:"#90a4ae",
1:"#a5d6a7",2:"#81c784",5:"#66bb6a",
10:"#4dd0e1",20:"#26c6da",
50:"#42a5f5",100:"#1e88e5",
200:"#ab47bc",500:"#fbc02d"
};

let data=JSON.parse(localStorage.getItem("skarbonka"))||{};
const list=document.getElementById("list");
const sumEl=document.getElementById("sum");
const pieCtx=document.getElementById("pie").getContext("2d");
const barCtx=document.getElementById("bars").getContext("2d");

function save(){localStorage.setItem("skarbonka",JSON.stringify(data));}

function render(){
 list.innerHTML="";
 denominations.forEach(v=>{
  const row=document.createElement("div");row.className="row";

  const dot=document.createElement("div");
  dot.className="dot";dot.style.background=colors[v];

  const label=document.createElement("div");
  label.textContent=v<1?(v*100+" gr"):(v+" zł");

  const count=document.createElement("div");
  count.textContent=data[v]||0;

  const controls=document.createElement("div");
  const minus=document.createElement("button");
  minus.textContent="−";minus.onclick=()=>sub(v);
  const plus=document.createElement("button");
  plus.textContent="+";plus.onclick=()=>add(v);
  controls.append(minus,plus);

  row.append(dot,label,count,controls);
  list.appendChild(row);
 });
}

function add(v){data[v]=(data[v]||0)+1;save();update();}
function sub(v){data[v]=Math.max(0,(data[v]||0)-1);save();update();}

function update(){
 let total=0;
 denominations.forEach(v=>total+=(data[v]||0)*v);
 sumEl.textContent=total.toFixed(2);
 drawPie(total);
 drawBars();
 render();
}

function drawPie(total){
 pieCtx.clearRect(0,0,220,220);
 const pct=Math.min(total/goal,1);
 pieCtx.beginPath();pieCtx.arc(110,110,90,0,Math.PI*2);pieCtx.fillStyle="#eee";pieCtx.fill();
 pieCtx.beginPath();pieCtx.moveTo(110,110);
 pieCtx.arc(110,110,90,-Math.PI/2,-Math.PI/2+Math.PI*2*pct);
 pieCtx.fillStyle="#00c853";pieCtx.fill();
 pieCtx.fillStyle="#000";pieCtx.font="24px Arial";pieCtx.textAlign="center";
 pieCtx.fillText(Math.round(pct*100)+"%",110,120);
}

function drawBars(){
 barCtx.clearRect(0,0,520,180);
 const counts=denominations.map(v=>data[v]||0);
 const max=Math.max(...counts,1);
 const w=26,g=6,h=120,base=150;
 const start=(520-(denominations.length*(w+g)))/2;

 barCtx.font="11px Arial";barCtx.textAlign="center";

 denominations.forEach((v,i)=>{
  const bar=(counts[i]/max)*h;
  const x=start+i*(w+g);
  const y=base-bar;
  barCtx.fillStyle=colors[v];
  barCtx.fillRect(x,y,w,bar);
  if(counts[i]>0) barCtx.fillStyle="#000",barCtx.fillText(counts[i],x+w/2,y-4);
  const label=v<1?v*100:v;
  barCtx.fillText(label,x+w/2,base+14);
 });
}

function resetAll(){
 if(confirm("Wyzerować skarbonkę?")){
  data={};save();update();
 }
}

update();
</script>
</body>
</html>
