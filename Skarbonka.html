<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Strzeżona $karbonka</title>
<style>
  body {
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    margin: 18px;
    background: #f7f7f8;
    color: #111;
    text-align: center;
  }
  .login-screen, .app-screen {
    max-width: 600px;
    margin: auto;
    text-align: center;
  }
  .login-screen {
    margin-top: 20vh;
  }
  input[type=password] {
    padding: 10px;
    width: 80%;
    max-width: 280px;
    margin-top: 12px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
  }
  button {
    padding: 10px 16px;
    margin-top: 12px;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    cursor: pointer;
  }
  .hidden {
    display: none;
  }
  :root {
    --cell-size: 40px;
    --gap: 4px;
    --cell-bg: #ffffff;
    --cell-border: #ddd;
  }
  header {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
  }
  .sum-box {
    background: #fff;
    border: 1px solid var(--cell-border);
    padding: 10px 14px;
    border-radius: 8px;
    min-width: 160px;
    box-shadow: 0 1px 0 rgba(0,0,0,0.03);
  }
  .controls {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin-top: 10px;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(10, var(--cell-size));
    grid-auto-rows: var(--cell-size);
    gap: var(--gap);
    justify-content: center;
  }
  .cell {
    width: var(--cell-size);
    height: var(--cell-size);
    border-radius: 8px;
    border: 1px solid var(--cell-border);
    background: var(--cell-bg);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    cursor: pointer;
    user-select: none;
    font-size: 0.9rem;
  }
  .cell.crossed {
    color: green;
  }
  footer {
    margin-top: 14px;
    font-size: .9rem;
    color: #444;
  }
  canvas {
    margin-top: 20px;
  }
</style>
</head>
<body>

<div class="login-screen" id="login">
  <h2>Podaj hasło, aby otworzyć</h2>
  <h2 style="color: rgb(5, 183, 5);">$karbonkę</h2>
  <input type="password" id="password" placeholder="Tu jest miejsce na hasło" />
  <br/>
  <button onclick="checkPassword()"><b>Otwórz</b></button>
  <p id="error" style="color:red;display:none;"><b>Nieprawidłowe hasło</b></p>
</div>

<div class="app-screen hidden" id="app">
  <header>
    <h2>$karbonka Strzeżona</h2>
    <div class="sum-box" aria-live="polite">Suma oszczędności: <strong id="sum" style="color: green;">0</strong></div>
  </header>
  <main>
    <div class="grid" id="grid" role="grid"></div>
    <footer><b>Powodzenia w <b style="color: green;"><u>oszczędzaniu</u></b></footer>
    <canvas id="chart" width="200" height="200"></canvas>
    <div class="controls" role="group" aria-label="Kontrolki">
      <button class="action" id="reset">Reset</button>
      <button class="action" id="toggleAll">Odwróć zaznaczenia</button>
    </div>
  </main>
</div>

<script>
(function(){
  const STORAGE_KEY = "grid_1_100_crossed_secure";
  const PASSWORD = "$$$"; // Zmień hasło
  const maxSum = 5050; // suma 1-100

  const canvas = document.getElementById("chart");
  const ctx = canvas.getContext("2d");

  window.checkPassword = function(){
    const input = document.getElementById("password").value;
    if(input === PASSWORD){
      document.getElementById("login").classList.add("hidden");
      document.getElementById("app").classList.remove("hidden");
      initApp();
    } else {
      document.getElementById("error").style.display = "block";
    }
  };

  function initApp(){
    const grid = document.getElementById('grid');
    const sumEl = document.getElementById('sum');
    const resetBtn = document.getElementById('reset');
    const toggleAllBtn = document.getElementById('toggleAll');

    function loadState(){
      try {
        const data = localStorage.getItem(STORAGE_KEY);
        return data ? JSON.parse(data) : [];
      } catch(e){ return []; }
    }

    function saveState(state){
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch(e){}
    }

    const saved = loadState();
    for(let i=1;i<=100;i++){
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'cell';
      btn.dataset.num = String(i);
      btn.textContent = i;
      if(saved.includes(i)){
        btn.classList.add('crossed');
        btn.textContent = "$";
      }
      btn.addEventListener('click', () => {
        btn.classList.toggle('crossed');
        btn.textContent = btn.classList.contains('crossed') ? "$" : i;
        updateSum();
        persist();
      });
      grid.appendChild(btn);
    }

    function updateSum(){
      let s = 0;
      grid.querySelectorAll('.cell.crossed').forEach(c => s += Number(c.dataset.num) || 0);
      sumEl.textContent = String(s);
      drawChart(s);
    }

    function persist(){
      const crossed = Array.from(grid.querySelectorAll('.cell.crossed')).map(c => Number(c.dataset.num));
      saveState(crossed);
    }

    function drawChart(currentSum) {
      const percent = currentSum / maxSum;
      ctx.clearRect(0, 0, 200, 200);
      
      // Tło (biały okrąg)
      ctx.beginPath();
      ctx.arc(100, 100, 90, 0, Math.PI * 2);
      ctx.fillStyle = "#ffffff";
      ctx.fill();
      
      // Zielony fragment
      ctx.beginPath();
      ctx.moveTo(100, 100);
      ctx.arc(100, 100, 90, -Math.PI / 2, (percent * 2 * Math.PI) - Math.PI / 2);
      ctx.closePath();
      ctx.fillStyle = "#00aa00";
      ctx.fill();

      // Tekst procentu
      ctx.fillStyle = "#000000";
      ctx.font = "bold 20px Arial";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(Math.round(percent * 100) + "%", 100, 100);
    }

    resetBtn.addEventListener('click', () => {
      grid.querySelectorAll('.cell.crossed').forEach(c => {
        c.classList.remove('crossed');
        c.textContent = c.dataset.num;
      });
      updateSum();
      persist();
    });

    toggleAllBtn.addEventListener('click', () => {
      grid.querySelectorAll('.cell').forEach(c => {
        c.classList.toggle('crossed');
        c.textContent = c.classList.contains('crossed') ? "$" : c.dataset.num;
      });
      updateSum();
      persist();
    });

    updateSum();
  }
})();
</script>

</body>
</html>
